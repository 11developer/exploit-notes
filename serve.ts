import Server from "https://deno.land/x/lume@v1.19.3/core/server.ts";
// import expires from "https:/deno.land/x/lume/middlewares/expires.ts";
import notFound from "https://deno.land/x/lume@v1.19.3/middlewares/not_found.ts";

import { sleep } from "https://deno.land/x/sleep@v1.2.1/mod.ts";

// function expires(): import("https://deno.land/x/lume@v1.19.3/core/server.ts").Middleware {
//   throw new Error("Function not implemented.");
// }

const kv = await Deno.openKv();

const server = new Server({
  port: 8000,
  root: `${Deno.cwd()}/_site`,
});

// Rate limiting
server.use(async (request, next) => {
  const response = await next(request);

  await sleep(2);
  
  return response;
})

// Expires
// server.use(expires());

// Not found
server.use(notFound({
  root: `${Deno.cwd()}/_site`,
  page404: "/404",
}));

server.start();

console.log("Listening on http://localhost:8000");

